(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{376:function(s,a,e){"use strict";e.r(a);var t=e(42),l=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"mysql主从配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mysql主从配置"}},[s._v("#")]),s._v(" Mysql主从配置")]),s._v(" "),e("h2",{attrs:{id:"需要两台安装有mysql的系统"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#需要两台安装有mysql的系统"}},[s._v("#")]),s._v(" 需要两台安装有MySQL的系统")]),s._v(" "),e("p",[s._v("我的2台系统为 "),e("code",[s._v("Ubuntu")])]),s._v(" "),e("p",[s._v("主库ip： 192.168.126.128\n从库ip： 192.168.126.130")]),s._v(" "),e("h3",{attrs:{id:"主库配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#主库配置"}},[s._v("#")]),s._v(" 主库配置")]),s._v(" "),e("ol",[e("li",[s._v("首先，修改主的配置：")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/mysql/mysql.conf.d/mysqld.cnf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("在"),e("code",[s._v("[mysqld]")]),s._v("下添加如下的配置信息：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("server-id=1\nlog-bin=master-bin\nlog-bin-index=master-bin.index\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ol",{attrs:{start:"3"}},[e("li",[s._v("重启mysql:")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysql restart\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ol",{attrs:{start:"4"}},[e("li",[s._v("输入命令回车后，输入密码，登录mysql。")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("mysql -u root -p \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ol",{attrs:{start:"5"}},[e("li",[s._v("查看mysql的当前状态")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" master "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"http://47.104.70.51/blog/upload/2020/03/image-9c7066ff22ef40e2b14d1938021d59ba.png",alt:"image.png"}})]),s._v(" "),e("ol",{attrs:{start:"6"}},[e("li",[s._v("创建一个用来复制主信息的账户,并赋予其备份的权限。ip地址为从服务器的地址。")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("create user repl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("grant replication slave on *.* to "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'repl'")]),s._v("@"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.126.130'")]),s._v(" identified by "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("flush privileges"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ol",{attrs:{start:"7"}},[e("li",[s._v("创建一个测试数据库，用于查看同步的结果：")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("create database o2o"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"从库配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#从库配置"}},[s._v("#")]),s._v(" 从库配置")]),s._v(" "),e("ol",[e("li",[s._v("修改从库的配置文件：")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("vim /etc/mysql/mysql.conf.d/mysqld.cnf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("在"),e("code",[s._v("[mysqld]")]),s._v("下添加如下的配置信息：")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("server-id=2\nrelay-log=slave-relay-bin\nrelay-log-index=slave-relay-bin.index\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ol",{attrs:{start:"3"}},[e("li",[s._v("重启mysql:")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysql restart\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ol",{attrs:{start:"4"}},[e("li",[s._v("输入命令回车后，输入密码，登录mysql。")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("mysql -u root -p \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("从库配置主库连接的相关信息：\nchange master to master_host='192.168.126.128',master_port=3306,master_user='repl',master_password='mysql',master_log_file='master-bin.000001',master_log_pos=0;")]),s._v(" "),e("p",[s._v("备注：这里的master_log_pos设置为0而不是107的原因在于，当前主库日志文件已经到位置107了，而从库尚未开始复制，自然是从0位置作为起始的复制点，而不是主库的当前位置107，否则主库通过指令create database o2o;新建库o2o的操作就无法同步过来了，后面基于这个库的指令重放可能会出问题。")]),s._v(" "),e("p",[s._v("完成之后查看一下当前salave的状态：")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" slave "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),s._v(" \\G\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])])}),[],!1,null,null,null);a.default=l.exports}}]);