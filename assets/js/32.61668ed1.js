(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{388:function(r,n,t){"use strict";t.r(n);var e=t(42),s=Object(e.a)({},(function(){var r=this,n=r.$createElement,t=r._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":r.$parent.slotKey}},[t("h1",{attrs:{id:"时钟同步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#时钟同步"}},[r._v("#")]),r._v(" 时钟同步")]),r._v(" "),t("h2",{attrs:{id:"方法一-chronyc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法一-chronyc"}},[r._v("#")]),r._v(" 方法一:chronyc")]),r._v(" "),t("ol",[t("li",[t("p",[r._v("这个软件包含两个命令集: chronyc 客户端 和 chronyd 守护进程. 安装chrony方法:"),t("br"),r._v(" "),t("code",[r._v("sudo apt install chrony")])])]),r._v(" "),t("li",[t("p",[r._v("验证 chrony是否安装成功，并查看有多少个服务端及结点已连接："),t("br"),r._v(" "),t("code",[r._v("chronyc activity")]),t("br"),r._v("\n200 OK"),t("br"),r._v("\n8 sources online"),t("br"),r._v("\n0 sources offline"),t("br"),r._v("\n0 sources doing burst (return to online)"),t("br"),r._v("\n0 sources doing burst (return to offline)"),t("br"),r._v("\n0 sources with unknown address")])]),r._v(" "),t("li",[t("p",[t("code",[r._v("vim /etc/chrony/chrony.conf")]),t("br"),r._v(" "),t("a",{attrs:{href:"https://chrony.tuxfamily.org/doc/3.5/chrony.conf.html",target:"_blank",rel:"noopener noreferrer"}},[r._v("配置参考链接https://chrony.tuxfamily.org/doc/3.5/chrony.conf.html"),t("OutboundLink")],1)])])]),r._v(" "),t("h3",{attrs:{id:"常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[r._v("#")]),r._v(" 常用命令：")]),r._v(" "),t("p",[r._v("检查 Chrony 是否实际同步"),t("br"),r._v(" "),t("code",[r._v("chronyc tracking")]),t("br"),r._v("\nReference ID    : AB42617E (srcf-ntp.stanford.edu)"),t("br"),r._v("\nStratum         : 2"),t("br"),r._v("\nRef time (UTC)  : Thu Apr 05 18:27:33 2018"),t("br"),r._v("\nSystem time     : 0.000669840 seconds slow of NTP time"),t("br"),r._v("\nLast offset     : -0.000506939 seconds"),t("br"),r._v("\nRMS offset      : 0.001261410 seconds"),t("br"),r._v("\nFrequency       : 28.552 ppm slow"),t("br"),r._v("\nResidual freq   : -0.000 ppm"),t("br"),r._v("\nSkew            : 88.846 ppm"),t("br"),r._v("\nRoot delay      : 0.031207338 seconds"),t("br"),r._v("\nRoot dispersion : 0.001206590 seconds"),t("br"),r._v("\nUpdate interval : 65.2 seconds"),t("br"),r._v("\nLeap status     : Normal"),t("br"),r._v("\nsources")]),r._v(" "),t("blockquote",[t("p",[r._v("这里主要关注 Update interval 这个参数, 说明最后两次更新的时间间隔是 64.1s。以上结果中的其它参数的含义分别是："),t("br"),r._v("\n引用 ID - 计算机当前同步的引用 ID 和名称。"),t("br"),r._v("\nStratum - 连接参考时钟的计算机的跳数。"),t("br"),r._v("\n参考时间 - 这是参考源的最后一次测量的 UTC 时间。"),t("br"),r._v("\n系统时间 - 来自同步服务器的系统时钟延迟。"),t("br"),r._v("\n最后一次偏移 - 上次时钟更新的估计偏移量。"),t("br"),r._v("\nRMS 偏移 - 偏移值的长期平均值。"),t("br"),r._v("\n频率 - 如果 chronyd 没有纠正它，那么系统的时钟错误的速率。它以 ppm （百万分率）提供。"),t("br"),r._v("\n残余频率 - 残余频率表示参考源的测量值与当前使用的频率之间的差异。"),t("br"),r._v("\n偏斜 - 估计频率的误差界限。"),t("br"),r._v("\n根延迟 - 网络路径延迟到计算机正在同步的层计算机的总和。"),t("br"),r._v("\n跳跃状态 - 这是跳跃状态，可以具有以下值之一：正常、插入秒、删除秒或不同步。")])]),r._v(" "),t("p",[r._v("显示所有 NTP 源服务器的信息"),t("br"),r._v(" "),t("code",[r._v("chronyc sources -v")]),t("br"),r._v("\n查看 NTP 服务器的在线和离线状态"),t("br"),r._v(" "),t("code",[r._v("chronyc activity")]),t("br"),r._v("\n查看 Chrony 服务的日志"),t("br"),r._v(" "),t("code",[r._v("journalctl -u chronyd")]),t("br"),r._v("\n检查 NTP 访问是否对特定主机可用"),t("br"),r._v(" "),t("code",[r._v("chronyc accheck")]),t("br"),r._v("\n该命令会显示有多少 NTP 源在线/离线"),t("br"),r._v(" "),t("code",[r._v("chronyc activity")]),t("br"),r._v("\n手动添加一台新的 NTP 服务器"),t("br"),r._v(" "),t("code",[r._v("chronyc add server")]),t("br"),r._v("\n在客户端报告已访问到服务器"),t("br"),r._v(" "),t("code",[r._v("chronyc clients")]),t("br"),r._v("\n手动移除 NTP 服务器或对等服务器"),t("br"),r._v(" "),t("code",[r._v("chronyc delete")]),t("br"),r._v("\n手动设置守护进程时间"),t("br"),r._v(" "),t("code",[r._v("chronyc settime")]),t("br"),r._v("\n校准时间服务器，显示系统时间信息"),t("br"),r._v(" "),t("code",[r._v("chronyc tracking")]),t("br"),r._v("\n检查 NTP 访问是否对特定主机可用"),t("br"),r._v(" "),t("code",[r._v("chronyc accheck")]),t("br"),r._v("\n查看时间同步源"),t("br"),r._v(" "),t("code",[r._v("chronyc sources -v")]),t("br"),r._v("\n查看时间同步源状态"),t("br"),r._v(" "),t("code",[r._v("chronyc sourcestats -v")])]),r._v(" "),t("h2",{attrs:{id:"方法二-ntpdate"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法二-ntpdate"}},[r._v("#")]),r._v(" 方法二:ntpdate")]),r._v(" "),t("ol",[t("li",[r._v("安装ntpdate工具")])]),r._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[r._v("sudo")]),r._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[r._v("apt-get")]),r._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[r._v("install")]),r._v(" ntpdate\n")])]),r._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[r._v("1")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[r._v("设置系统时间与网络时间同步")])]),r._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[r._v("sudo")]),r._v(" ntpdate cn.pool.ntp.org\n")])]),r._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[r._v("1")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[r._v("将系统时间写入硬件时间")])]),r._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[r._v("sudo")]),r._v(" hwclock --systohc\n")])]),r._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[r._v("1")]),t("br")])])])}),[],!1,null,null,null);n.default=s.exports}}]);